(()=>{var e={984:e=>{e.exports=function(e){let t=e.url;if(void 0===t)return t;let o=e._parsedUrl;if(o&&o._raw===t)return o;o={},o.query=o.search=null,o.href=o.path=o.pathname=t;let n=t.indexOf("?",1);return-1!==n&&(o.search=t.substring(n),o.query=o.search.substring(1),o.pathname=t.substring(0,n)),o._raw=t,e._parsedUrl=o}},148:(e,t,o)=>{const n=o(611),s=o(706),{parse:r}=o(480),i=o(984);function a(e){return 47===e.charCodeAt(0)?e:"/"+e}function l(e){let t=e.indexOf("/",1);return t>1?e.substring(0,t):e}function c(e,t){t.url=t.url.substring(e.length)||"/",t.path=t.path.substring(e.length)||"/"}function u(e,t,o,s){let r=o.statusCode=e.code||e.status||500;o.end(e.length&&e||e.message||n.STATUS_CODES[r])}class d extends s{constructor(e={}){super(e),this.apps={},this.wares=[],this.bwares={},this.parse=i,this.server=e.server,this.handler=this.handler.bind(this),this.onError=e.onError||u,this.onNoMatch=e.onNoMatch||this.onError.bind(null,{code:404})}add(e,t,...o){let n=a(l(t));if(void 0!==this.apps[n])throw new Error(`Cannot mount ".${e.toLowerCase()}('${a(t)}')" because a Polka application at ".use('${n}')" already exists! You should move this handler into your Polka application instead.`);return super.add(e,t,...o)}use(e,...t){return"function"==typeof e?this.wares=this.wares.concat(e,t):"/"===e?this.wares=this.wares.concat(t):(e=a(e),t.forEach((t=>{if(t instanceof d)this.apps[e]=t;else{let o=this.bwares[e]||[];o.length>0||o.push(((t,o,n)=>(c(e,t),n()))),this.bwares[e]=o.concat(t)}}))),this}listen(){return(this.server=this.server||n.createServer()).on("request",this.handler),this.server.listen.apply(this.server,arguments),this}handler(e,t,o){o=o||this.parse(e);let n=[],s=this.wares,i=this.find(e.method,o.pathname);e.originalUrl=e.originalUrl||e.url;let a=l(e.path=o.pathname);void 0!==this.bwares[a]&&(s=s.concat(this.bwares[a])),i?(n=i.handlers,e.params=i.params):void 0!==this.apps[a]?(c(a,e),o.pathname=e.path,n.push(this.apps[a].handler.bind(null,e,t,o))):0===n.length&&n.push(this.onNoMatch),e.search=o.search,e.query=r(o.query);let u=0,d=s.length,p=n.length;if(d===u&&1===p)return n[0](e,t);let h=o=>o?this.onError(o,e,t,h):f(),f=o=>t.finished||u<d&&s[u++](e,t,h);s=s.concat(n),d+=p,f()}}e.exports=e=>new d(e)},706:(e,t,o)=>{const{exec:n,match:s,parse:r}=o(891);e.exports=class{constructor(e){this.opts=e||{},this.routes={},this.handlers={},this.all=this.add.bind(this,"*"),this.get=this.add.bind(this,"GET"),this.head=this.add.bind(this,"HEAD"),this.patch=this.add.bind(this,"PATCH"),this.options=this.add.bind(this,"OPTIONS"),this.connect=this.add.bind(this,"CONNECT"),this.delete=this.add.bind(this,"DELETE"),this.trace=this.add.bind(this,"TRACE"),this.post=this.add.bind(this,"POST"),this.put=this.add.bind(this,"PUT")}add(e,t,...o){return void 0===this.routes[e]&&(this.routes[e]=[]),this.routes[e].push(r(t)),void 0===this.handlers[e]&&(this.handlers[e]={}),this.handlers[e][t]=o,this}find(e,t){let o=s(t,this.routes[e]||[]);return!(0===o.length&&(o=s(t,this.routes[e="*"]||[]),!o.length))&&{params:n(t,o),handlers:this.handlers[e][o[0].old]}}}},28:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0;const s=n(o(398));t.config=new class{get inference(){let e=this.#e,t=e.get("aiProvider").trim();""===t&&(t="dAppForge");let o=e.get("endpoint").trim();o.endsWith("/")&&(o=o.slice(0,o.length-1).trim()),""===o&&(o="http://127.0.0.1:11434");let n=e.get("bearerToken"),s=e.get("maxLines"),r=e.get("maxTokens"),i=e.get("temperature"),a=e.get("model"),l="codellama";return"custom"===a?(a=e.get("custom.model"),l=e.get("cutom.format")):a.startsWith("deepseek-coder")?l="deepseek":a.startsWith("stable-code")&&(l="stable-code"),{aiProvider:t,endpoint:o,bearerToken:n,maxLines:s,maxTokens:r,temperature:i,modelName:a,modelFormat:l,delay:e.get("delay")}}get notebook(){let e=s.default.workspace.getConfiguration("notebook");return{includeMarkup:e.get("includeMarkup"),includeCellOutputs:e.get("includeCellOutputs"),cellOutputLimit:e.get("cellOutputLimit")}}get#e(){return s.default.workspace.getConfiguration("inference")}}},921:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INLINE_COMPLETION_ACCEPTED_COMMAND=t.SERVER_PORT=t.getApiBaseUrl=void 0,t.getApiBaseUrl=function(e){return"dev"===e?"http://127.0.0.1:35245":"https://xs84120lea.execute-api.us-east-1.amazonaws.com/prod"},t.SERVER_PORT=54021,t.INLINE_COMPLETION_ACCEPTED_COMMAND="dappforge.InlineCompletionAccepted"},265:function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,s)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const i=r(o(398)),a=o(872),l=o(757),c=o(360),u=o(212),d=o(921);t.activate=function(e){const t=i.workspace.getConfiguration("dAppForge").get("environment","dev");console.log(`Environment: ${t}`),c.TokenManager.globalState=e.globalState,c.TokenManager.setBasicAuthToken(),c.TokenManager.loggedIn()||c.TokenManager.resetTokens(),c.TokenManager.setToken(c.API_BASE_URL,(0,d.getApiBaseUrl)(t));let o=i.window.createStatusBarItem(i.StatusBarAlignment.Right,100);e.subscriptions.push(o),o.command="dappforge.toggle",o.text="$(chip) dAppForge",o.show(),e.subscriptions.push(i.commands.registerCommand("dappforge.openSettings",(()=>{i.commands.executeCommand("workbench.action.openSettings","@ext:dappforge.dappforge")})));const n=new u.PromptProvider(o,e);e.subscriptions.push(i.languages.registerInlineCompletionItemProvider({pattern:"**"},n)),e.subscriptions.push(i.commands.registerCommand("dappforge.pause",(()=>{n.paused=!0}))),e.subscriptions.push(i.commands.registerCommand("dappforge.resume",(()=>{n.paused=!1}))),e.subscriptions.push(i.commands.registerCommand("dappforge.toggle",(()=>{n.paused=!n.paused}))),e.subscriptions.push(i.commands.registerCommand("dappforge.authorised",(()=>{n.authorised=!0}))),e.subscriptions.push(i.commands.registerCommand("dappforge.unauthorised",(()=>{n.authorised=!1})));const s=new a.SidebarProvider(e.extensionUri);e.subscriptions.push(i.window.registerWebviewViewProvider("dappforge-sidebar",s)),e.subscriptions.push(i.commands.registerCommand("dappforge.authenticate",(()=>{try{(0,l.authenticate)()}catch(e){console.log(e)}}))),e.subscriptions.push(i.commands.registerCommand("dappforge.refresh",(async()=>{await i.commands.executeCommand("workbench.action.closeSidebar"),await i.commands.executeCommand("workbench.view.extension.dappforge-sidebar-view")}))),e.subscriptions.push(i.commands.registerCommand(d.INLINE_COMPLETION_ACCEPTED_COMMAND,(()=>{n.completionAccepted(s,1)})))},t.deactivate=function(){}},21:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNonce=void 0,t.getNonce=function(){let e="";for(let t=0;t<32;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}},360:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenManager=t.AUTO_COMPLETE_ACTIVE=t.API_BASE_URL=t.TOKEN_COUNT=t.BASIC_AUTH_TOKEN=t.USER_ID_KEY=t.REFRESH_TOKEN_KEY=t.ACCESS_TOKEN_KEY=void 0;const n=o(185);t.ACCESS_TOKEN_KEY="dappforgeaccesstoken",t.REFRESH_TOKEN_KEY="dappforgerefreshtoken",t.USER_ID_KEY="dappforgeuserid",t.BASIC_AUTH_TOKEN="dappforgebasicauth",t.TOKEN_COUNT="dappforgetokencount",t.API_BASE_URL="dappforgetokenapibaseurl",t.AUTO_COMPLETE_ACTIVE="dappforgetokenautocompleteactive";class s{static globalState;static setBasicAuthToken(){this.setToken(t.BASIC_AUTH_TOKEN,(0,n.getBasicAuthToken)())}static setToken(e,t){return this.globalState.update(e,t)}static getToken(e){return this.globalState.get(e)}static getTokensAsJsonString(){return JSON.stringify({basicAuthToken:s.getToken(t.BASIC_AUTH_TOKEN),userId:s.getToken(t.USER_ID_KEY),accessToken:s.getToken(t.ACCESS_TOKEN_KEY),refreshToken:s.getToken(t.REFRESH_TOKEN_KEY)})}static setTokens(e,o,n){this.setToken(t.USER_ID_KEY,e),this.setToken(t.ACCESS_TOKEN_KEY,o),this.setToken(t.REFRESH_TOKEN_KEY,n)}static resetTokens(){this.setToken(t.USER_ID_KEY,""),this.setToken(t.ACCESS_TOKEN_KEY,""),this.setToken(t.REFRESH_TOKEN_KEY,""),this.setToken(t.TOKEN_COUNT,"0")}static getTokenCount(){const e=this.getToken(t.TOKEN_COUNT);return e&&e.length>0?Number(e):0}static loggedIn(){return!(!s.getToken(t.USER_ID_KEY)||""===s.getToken(t.USER_ID_KEY))}}t.TokenManager=s},757:function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,s)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return s(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authenticate=void 0;const a=r(o(398)),l=o(921),c=i(o(148)),u=o(360);let d=null;t.authenticate=async e=>{d&&d.server.close();const t=u.TokenManager.getToken(u.API_BASE_URL);d=(0,c.default)(),d.get("/auth/:id/:accessToken/:refreshToken",(async(t,o)=>{const{id:n,accessToken:s,refreshToken:r}=t.params;s&&r?(u.TokenManager.setTokens(n,s,r),e&&e(),o.end("<h1>dAppForge authentication was successful, you can close this now</h1>"),d.server.close(),d=null):o.end("<h1>Failed to authenticate, something went wrong</h1>")})),d.listen(l.SERVER_PORT,(e=>{e?a.window.showErrorMessage(e.message):a.commands.executeCommand("vscode.open",a.Uri.parse(`${t}/auth/github`))}))}},93:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lineGenerator=void 0,t.lineGenerator=async function*(e,t,o){const n=new AbortController;let s=await fetch(e,{method:"POST",body:JSON.stringify(t),headers:o?{"Content-Type":"application/json",Authorization:`Bearer ${o}`}:{"Content-Type":"application/json"},signal:n.signal});if(!s.ok||!s.body)throw Error("Unable to connect to backend");let r=s.body.getReader();const i=new TextDecoder;let a="";try{for(;;){const{done:e,value:t}=await r.read();if(e){a.length>0&&(yield a);break}let o=i.decode(t);for(console.warn(o),a+=o;a.indexOf("\n")>=0;){let e=a.indexOf("\n");yield a.slice(0,e),a=a.slice(e+1)}}}finally{r.releaseLock(),r.closed||await r.cancel(),n.abort()}}},675:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncLock=void 0,t.AsyncLock=class{permits=1;promiseResolverQueue=[];async inLock(e){try{return await this.lock(),await e()}finally{this.unlock()}}async lock(){this.permits>0?this.permits=this.permits-1:await new Promise((e=>this.promiseResolverQueue.push(e)))}unlock(){if(this.permits+=1,this.permits>1&&this.promiseResolverQueue.length>0)throw new Error("this.permits should never be > 0 when there is someone waiting.");if(1===this.permits&&this.promiseResolverQueue.length>0){this.permits-=1;const e=this.promiseResolverQueue.shift();e&&setTimeout((()=>{e(!0)}),0)}}}},979:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ollamaCheckModel=void 0,t.ollamaCheckModel=async function(e,t,o){let n=await fetch(e+"/api/tags",{headers:o?{Authorization:`Bearer ${o}`}:{}});if(!n.ok)throw console.log(await n.text()),console.log(e+"/api/tags"),Error("Network response was not ok.");return!!(await n.json()).models.find((e=>e.name===t))}},13:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ollamaDownloadModel=void 0;const n=o(93);t.ollamaDownloadModel=async function(e,t,o){console.log("Downloading model from ollama: "+t);for await(let s of(0,n.lineGenerator)(e+"/api/pull",{name:t},o))console.log("[DOWNLOAD] "+s)}},116:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ollamaTokenGenerator=void 0;const n=o(93);t.ollamaTokenGenerator=async function*(e,t,o){for await(let s of(0,n.lineGenerator)(e,t,o)){let e;console.log("Receive line: "+s);try{e=JSON.parse(s)}catch(e){console.warn("Receive wrong line: "+s);continue}yield e}}},655:(e,t)=>{"use strict";function o(e){return 0===e.trim().length}function n(e){for(let t=0;t<e.length;t++)if(!o(e[t]))return t;return e.length}function s(e,t){let o=0;for(let n=0;n<e.length;n++)e[n]===t&&o++;return o}Object.defineProperty(t,"__esModule",{value:!0}),t.countSymbol=t.trimEndBlank=t.trimIndent=t.indentWidth=t.isBlank=t.countLines=void 0,t.countLines=function(e){return s(e,"\n")+1},t.isBlank=o,t.indentWidth=n,t.trimIndent=function(e){let t=e.split("\n");if(0===t.length)return"";if(1===t.length)return t[0].trim();if(o(t[0])&&(t=t.slice(1)),o(t[t.length-1])&&(t=t.slice(0,t.length-1)),0===t.length)return"";let s=t.filter((e=>!o(e))).map((e=>n(e))),r=s.length>0?Math.min(...s):0;return t.map((e=>o(e)?"":e.slice(r).trimEnd())).join("\n")},t.trimEndBlank=function(e){let t=e.split("\n");for(let e=t.length-1;e++;e>=0)o(t[e])&&t.splice(e);return t.join("\n")},t.countSymbol=s},522:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dappforgeAutocomplete=t.autocomplete=void 0;const n=o(116),s=o(655),r=o(360),i=o(185),a=o(264);t.autocomplete=async function(e){let t=(0,a.adaptPrompt)({prefix:e.prefix,suffix:e.suffix,format:e.format}),o={model:e.model,prompt:t.prompt,raw:!0,options:{stop:t.stop,num_predict:e.maxTokens,temperature:e.temperature}},r="",i=1,l=[];e:for await(let t of(0,n.ollamaTokenGenerator)(e.endpoint+"/api/generate",o,e.bearerToken)){if(e.canceled&&e.canceled())break;for(let e of t.response){if("["===e?l.push("["):"("===e&&l.push("("),"{"===e&&l.push("{"),"]"===e){if(!(l.length>0&&"["===l[l.length-1])){console.log("Block stack error, breaking.");break e}l.pop()}if(")"===e){if(!(l.length>0&&"("===l[l.length-1])){console.log("Block stack error, breaking.");break e}l.pop()}if("}"===e){if(!(l.length>0&&"{"===l[l.length-1])){console.log("Block stack error, breaking.");break e}l.pop()}r+=e}if(i+=(0,s.countSymbol)(t.response,"\n"),i>e.maxLines&&0===l.length){console.log("Too many lines, breaking.");break}}return r.endsWith("<EOT>")&&(r=r.slice(0,r.length-5)),r=r.split("\n").map((e=>e.trimEnd())).join("\n"),r},t.dappforgeAutocomplete=async function(e){const t={prefix_code:function(e,t=250){const o=e.slice(-t),n=o.search(/\s\w/),s=-1!==n?o.slice(n+1):o,r=o.search(/\. \w/);return-1!==r&&o.slice(r+2),s.trim()}(e.prefix)};console.log(`prompt: ${JSON.stringify(t,void 0,2)}`);const o=`${r.TokenManager.getToken(r.API_BASE_URL)}/ai/generate_code/${r.TokenManager.getToken(r.USER_ID_KEY)}`,n=`Basic ${(0,i.getBasicAuthToken)()}`;console.log(`url: ${o} prompt: ${JSON.stringify(t)} auth: ${n}`);const s=r.TokenManager.getToken(r.ACCESS_TOKEN_KEY)||"",a=r.TokenManager.getToken(r.REFRESH_TOKEN_KEY)||"";let l=await fetch(o,{method:"POST",body:JSON.stringify(t),headers:{Authorization:n,"Content-Type":"application/json; charset=UTF-8",Accept:"application/json","access-token":s,"refresh-token":a}});if(!l.ok||!l.body){if(l.body){let e="",t=await l.text();if(t.includes("completed_code")){const t=await l.json();console.log(`completed_code: ${JSON.stringify(t,void 0,2)}`),t.hasOwnProperty("detail")&&(e=t.detail)}else e=t;throw Error(`Error when trying to query the AI, status: ${l.status} error: ${e}`)}throw Error("Unable to connect to backend")}if(200!==l.status){let e="";const t=await l.json();throw console.log(`completed_code: ${JSON.stringify(t,void 0,2)}`),t.hasOwnProperty("detail")&&(e=t.detail),Error(`Error when trying to query the AI, status: ${l.status} error: ${e}`)}console.log(`res.body: ${l.body}`);const c=await l.json();console.log(`returned code: ${JSON.stringify(c,void 0,2)}`);let u="";return c.hasOwnProperty("generated_code")&&(u=c.generated_code,u=u.replace(/\\n/g,"\n"),u=u.split("\n").map((e=>e.trimEnd())).join("\n"),console.log(`completed_code: ${u}`)),console.log(`code: ${u}`),u}},624:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isNotNeeded=t.isSupported=void 0;const s=n(o(928));t.isSupported=function(e,t){return("file"===e.uri.scheme||"vscode-notebook-cell"===e.uri.scheme||"vscode-remote"===e.uri.scheme)&&("dAppForge"!==t||"dAppForge"===t&&".rs"===s.default.extname(e.uri.fsPath))},t.isNotNeeded=function(e,t,o){return!1}},761:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.preparePrompt=void 0;const s=n(o(398)),r=o(855),i=o(995),a=o(28);var l=new TextDecoder("utf8");t.preparePrompt=async function(e,t,o){let n,c=e.getText(),u=e.offsetAt(t),d=c.slice(0,u),p=c.slice(u),h=a.config.notebook,f=function(e){return s.default.workspace.notebookDocuments.find((t=>t.uri.path===e.uri.path))}(e),g=(0,r.detectLanguage)(e.uri.fsPath,e.languageId);if(g&&(n=i.languages[g].comment?.start),f){let t=!0,o="",r="";f.getCells().forEach((i=>{let a="";if(i.document.uri.fragment!==e.uri.fragment){if(i.kind===s.default.NotebookCellKind.Markup&&n){if(h.includeMarkup)for(const e of i.document.getText().split("\n"))a+=`\n${n}${e}`}else a+=i.document.getText();if(h.includeCellOutputs&&t&&i.kind===s.default.NotebookCellKind.Code&&n){let e=i.outputs.map((e=>e.items.filter((e=>"text/plain"===e.mime)).map((e=>l.decode(e.data))).map((e=>e.slice(0,h.cellOutputLimit).split("\n"))))).flat(3);if(e.length>0){a+=`\n${n}Output:`;for(const t of e)a+=`\n${n}${t}`}}t?o+=a:r+=a}else t=!1})),d=o+d,p+=r}return{prefix:d,suffix:p}}},855:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.detectLanguage=void 0;const s=n(o(928)),r=o(995);let i={typescriptreact:"typescript",javascriptreact:"javascript",jsx:"javascript"};t.detectLanguage=function(e,t){if(t&&i[t])return i[t];if(t&&r.languages[t])return t;let o=s.default.basename(e),n=s.default.extname(o).toLowerCase();for(let e in r.languages){let t=r.languages[e];for(let o of t.extensions)if(n===o)return e}return null}},995:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.languages=void 0,t.languages={typescript:{name:"Typescript",extensions:[".ts",".tsx",".cts",".mts"],comment:{start:"//"}},javascript:{name:"Javascript",extensions:[".js",".jsx",".cjs"],comment:{start:"//"}},html:{name:"HTML",extensions:[".htm",".html"],comment:{start:"\x3c!--",end:"--\x3e"}},css:{name:"CSS",extensions:[".css",".scss",".sass",".less"]},json:{name:"JSON",extensions:[".json",".jsonl",".geojson"]},yaml:{name:"YAML",extensions:[".yml",".yaml"],comment:{start:"#"}},xml:{name:"XML",extensions:[".xml"],comment:{start:"\x3c!--",end:"--\x3e"}},java:{name:"Java",extensions:[".java"],comment:{start:"//"}},kotlin:{name:"Kotlin",extensions:[".kt",".ktm",".kts"],comment:{start:"//"}},swift:{name:"Swift",extensions:[".swift"],comment:{start:"//"}},"objective-c":{name:"Objective C",extensions:[".h",".m",".mm"],comment:{start:"//"}},rust:{name:"Rust",extensions:[".rs",".rs.in"],comment:{start:"//"}},python:{name:"Python",extensions:[".py","ipynb"],comment:{start:"#"}},c:{name:"C",extensions:[".c",".h"],comment:{start:"//"}},cpp:{name:"C++",extensions:[".cpp",".h"],comment:{start:"//"}},go:{name:"Go",extensions:[".go"],comment:{start:"//"}},php:{name:"PHP",extensions:[".aw",".ctp",".fcgi",".inc",".php",".php3",".php4",".php5",".phps",".phpt"],comment:{start:"//"}},bat:{name:"BAT file",extensions:[".bat",".cmd"],comment:{start:"REM"}},shellscript:{name:"Shell",extensions:[".bash",".sh"],comment:{start:"#"}}}},264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.adaptPrompt=void 0,t.adaptPrompt=function(e){return"deepseek"===e.format?{prompt:`<｜fim▁begin｜>${e.prefix}<｜fim▁hole｜>${e.suffix}<｜fim▁end｜>`,stop:["<｜fim▁begin｜>","<｜fim▁hole｜>","<｜fim▁end｜>","<END>"]}:"stable-code"===e.format?{prompt:`<fim_prefix>${e.prefix}<fim_suffix>${e.suffix}<fim_middle>`,stop:["<|endoftext|>"]}:{prompt:`<PRE> ${e.prefix} <SUF> ${e.suffix} <MID>`,stop:["<END>","<EOD>","<EOT>"]}}},588:(e,t)=>{"use strict";function o(e){return(e=e.split("\n").join(" ")).replace(/\s+/gm," ")}function n(e){return e.suffix?o(e.prefix+" ##CURSOR## "+e.suffix):o(e.prefix)}Object.defineProperty(t,"__esModule",{value:!0}),t.setPromptToCache=t.getFromPromptCache=void 0;let s={};t.getFromPromptCache=function(e){const t=n(e);return s[t]},t.setPromptToCache=function(e){const t=n(e);s[t]=e.value}},872:function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,s)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SidebarProvider=void 0;const i=r(o(398)),a=o(757),l=o(21),c=o(360);t.SidebarProvider=class{_extensionUri;_view;_doc;constructor(e){this._extensionUri=e}postMessageToWebview(e){this._view?.webview.postMessage(e)}resolveWebviewView(e){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),e.webview.onDidReceiveMessage((async t=>{switch(console.log(`---\x3e<><> onDidReceiveMessage ${JSON.stringify(t,void 0,2)}`),t.type){case"logout":c.TokenManager.resetTokens(),i.commands.executeCommand("dappforge.unauthorised");break;case"authenticate":(0,a.authenticate)((()=>{e.webview.postMessage({type:"token",value:c.TokenManager.getTokensAsJsonString()})}));break;case"logged-in-out":t.value?(c.TokenManager.setToken(c.TOKEN_COUNT,String(t.value.tokenCount)),t.value.tokenCount<=0?i.commands.executeCommand("dappforge.unauthorised"):i.commands.executeCommand("dappforge.authorised")):(c.TokenManager.resetTokens(),i.commands.executeCommand("dappforge.unauthorised"));break;case"get-token":e.webview.postMessage({type:"token",value:c.TokenManager.getTokensAsJsonString()});break;case"onInfo":if(!t.value)return;i.window.showInformationMessage(t.value);break;case"onError":if(!t.value)return;i.window.showErrorMessage(t.value)}}))}revive(e){this._view=e}_getHtmlForWebview(e){const t=e.asWebviewUri(i.Uri.joinPath(this._extensionUri,"media","reset.css")),o=e.asWebviewUri(i.Uri.joinPath(this._extensionUri,"media","vscode.css")),n=e.asWebviewUri(i.Uri.joinPath(this._extensionUri,"out","compiled/sidebar.js")),s=e.asWebviewUri(i.Uri.joinPath(this._extensionUri,"out","compiled/sidebar.css")),r=(0,l.getNonce)();return`<!DOCTYPE html>\n\t\t\t<html lang="en">\n\t\t\t<head>\n\t\t\t\t<meta charset="UTF-8">\n\t\t\t\t\x3c!--\n\t\t\t\t\tUse a content security policy to only allow loading images from https or from our extension directory,\n\t\t\t\t\tand only allow scripts that have a specific nonce.\n        --\x3e\n        <meta http-equiv="Content-Security-Policy" content="img-src https: data:; style-src 'unsafe-inline' ${e.cspSource}; script-src 'nonce-${r}';">\n\t\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\t\t\t\t<link href="${t}" rel="stylesheet">\n\t\t\t\t<link href="${o}" rel="stylesheet">\n        <link href="${s}" rel="stylesheet">\n        <script nonce="${r}">\n          const tsvscode = acquireVsCodeApi();\n          const apiBaseUrl = ${JSON.stringify(c.TokenManager.getToken(c.API_BASE_URL))}\n        <\/script>\n\t\t\t</head>\n      <body>\n\t\t\t\t<script nonce="${r}" src="${n}"><\/script>\n\t\t\t</body>\n\t\t\t</html>`}}},212:function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromptProvider=void 0;const s=n(o(398)),r=o(522),i=o(761),a=o(675),l=o(588),c=o(624),u=o(979),d=o(13),p=o(28),h=o(360),f=o(921);t.PromptProvider=class{lock=new a.AsyncLock;statusbar;context;_paused=!0;_solution_accepted=!1;_authorised=!1;_processing_request=!1;_status={icon:"chip",text:"dAppForge"};constructor(e,t){this.statusbar=e,this.context=t,this._authorised=h.TokenManager.loggedIn(),this._paused="true"===h.TokenManager.getToken(h.AUTO_COMPLETE_ACTIVE),this.update()}set authorised(e){this._authorised=h.TokenManager.loggedIn(),this.update()}get authorised(){return this._authorised}set paused(e){this._paused=e,h.TokenManager.setToken(h.AUTO_COMPLETE_ACTIVE,`${e}`),this.update()}get paused(){return!h.TokenManager.loggedIn()||this._paused}update(e,t){this._status.icon=e||this._status.icon,this._status.text=t||this._status.text;let o="",n="";this.paused||!this.authorised?(o=`$(sync-ignored) ${this._status.text}`,n=`${this._status.text} (Paused)`):(o=`$(${this._status.icon}) ${this._status.text}`,n=`${this._status.text}`),this.statusbar.text=o,this.statusbar.tooltip=n}async delayCompletion(e,t){return!(p.config.inference.delay<0||(await new Promise((t=>setTimeout(t,e))),t.isCancellationRequested))}async provideInlineCompletionItems(e,t,o,n){if(!await this.delayCompletion(p.config.inference.delay,n)||this._solution_accepted)return this._solution_accepted&&console.log("xxxxxxx do not query AI as solution was accepted"),void(this._solution_accepted=!1);try{if(this.paused||!this.authorised)return;console.log(`provideInlineCompletionItems:document: ${JSON.stringify(e,void 0,2)}`),console.log(`setting res at position: ${JSON.stringify(t,void 0,2)} context: ${JSON.stringify(o,void 0,2)}`);let a=p.config.inference;return(0,c.isSupported)(e,a.aiProvider)?(0,c.isNotNeeded)(e,t,o)?void console.log("No inline completion required"):n.isCancellationRequested?void console.log("Canceled before AI completion."):(console.log("Before lock"),this._processing_request=!0,await this.lock.inLock((async()=>{if(console.log("In lock"),this._solution_accepted)return;let c=await(0,i.preparePrompt)(e,t,o);if(n.isCancellationRequested)return void console.log("Canceled before AI completion.");console.log("Start to process AI request");let p=null;console.log(`<><><><>prepared.prefix: ${c.prefix} prepared.suffix: ${c.suffix} prepared.prefix.length: ${c.prefix?.length}`);let h=(0,l.getFromPromptCache)({prefix:c.prefix,suffix:c.suffix});if(void 0===h){console.log("not in cache"),this.update("sync~spin","dAppForge");try{if(console.log(`inferenceConfig.aiProvider: ${a.aiProvider}`),"Ollama"===a.aiProvider){let e=await(0,u.ollamaCheckModel)(a.endpoint,a.modelName,a.bearerToken);if(n.isCancellationRequested)return void console.log("Canceled after AI completion.");if(!e){if(this.context.globalState.get("llama-coder-download-ignored")===a.modelName)return void console.log("Ingoring since user asked to ignore download.");if("No"===await s.default.window.showInformationMessage(`Model ${a.modelName} is not downloaded. Do you want to download it? Answering "No" would require you to manually download model.`,"Yes","No"))return console.log("Ingoring since user asked to ignore download."),void this.context.globalState.update("llama-coder-download-ignored",a.modelName);this.update("sync~spin","Downloading"),await(0,d.ollamaDownloadModel)(a.endpoint,a.modelName,a.bearerToken),this.update("sync~spin","dAppForge")}if(n.isCancellationRequested)return void console.log("Canceled after AI completion.");console.log("Running AI completion..."),p=await(0,r.autocomplete)({prefix:c.prefix,suffix:c.suffix,endpoint:a.endpoint,bearerToken:a.bearerToken,model:a.modelName,format:a.modelFormat,maxLines:a.maxLines,maxTokens:a.maxTokens,temperature:a.temperature,canceled:()=>n.isCancellationRequested})}else console.log("Running dAppForge AI completion..."),p=await(0,r.dappforgeAutocomplete)({prefix:c.prefix,suffix:c.suffix,endpoint:a.endpoint,bearerToken:a.bearerToken,model:a.modelName,format:a.modelFormat,maxLines:a.maxLines,maxTokens:a.maxTokens,temperature:a.temperature,canceled:()=>n.isCancellationRequested});console.log(`AI completion completed: ${p}`),console.log(`store in cache prepared.prefix: ${c.prefix} prepared.suffix: ${c.suffix} res: ${p}`),(0,l.setPromptToCache)({prefix:c.prefix,suffix:c.suffix,value:p})}finally{this.update("chip","dAppForge")}}else null!==h&&(p=h);if(n.isCancellationRequested)console.log("Canceled after AI completion.");else if(p&&""!==p.trim()){console.log(`setting res at position: ${JSON.stringify(t,void 0,2)}`);const e=[],o=new s.default.InlineCompletionItem(p,new s.default.Range(t,t));return o.command={command:f.INLINE_COMPLETION_ACCEPTED_COMMAND,title:"Inline Completion Accepted"},e.push(o),e}}))):void console.log(`Unsupported document: ${e.uri.toString()} ignored.`)}catch(e){console.log("Error during inference:",e),s.default.window.showErrorMessage(e.message)}finally{this._processing_request=!1}}async completionAccepted(e,t){if(h.TokenManager.loggedIn()&&!this.paused){console.log("Call endpoint to reduce count"),this._solution_accepted=!0;try{let o=await fetch(`${h.TokenManager.getToken(h.API_BASE_URL)}/ai/reduce_token_count/${h.TokenManager.getToken(h.USER_ID_KEY)}`,{method:"POST",body:JSON.stringify({cost:t}),headers:{authorization:`Basic ${h.TokenManager.getToken(h.BASIC_AUTH_TOKEN)}`,"Content-Type":"application/json","access-token":h.TokenManager.getToken(h.ACCESS_TOKEN_KEY)||"","refresh-token":h.TokenManager.getToken(h.REFRESH_TOKEN_KEY)||""}});if(!o.ok||!o.body)throw Error("Unable to connect to backend");console.log(`res.body: ${o.body}`);const n=await o.json();console.log(`returned code: ${JSON.stringify(n,void 0,2)}`),h.TokenManager.setToken(h.TOKEN_COUNT,String(n.tokenCount)),n.tokenCount<=0?s.default.commands.executeCommand("dappforge.unauthorised"):s.default.commands.executeCommand("dappforge.authorised"),e.postMessageToWebview({type:"update-token-count",value:n.tokenCount})}catch(e){console.log("Error when trying to charge for the AI completion:",e),s.default.window.showErrorMessage(e.message)}}}}},185:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBasicAuthToken=t.PASSWORD=t.USERNAME=void 0,t.USERNAME="dappforge-api-user",t.PASSWORD="d8pp4ge-8pi-p8ssan-AI_app?thatwillanswerQuestions",t.getBasicAuthToken=function(){return Buffer.from(t.USERNAME+":"+t.PASSWORD).toString("base64")}},398:e=>{"use strict";e.exports=require("vscode")},611:e=>{"use strict";e.exports=require("http")},928:e=>{"use strict";e.exports=require("path")},480:e=>{"use strict";e.exports=require("querystring")},891:(e,t,o)=>{"use strict";function n(e,t){for(var o=0,n=e.length;o<n;o++)if(!t(e[o],o,e))return!1;return!0}o.r(t),o.d(t,{exec:()=>b,match:()=>m,parse:()=>_});const s="/",r=0,i=1,a=2,l=3,c=47,u=58,d=42,p=63;function h(e){if(e===s)return e;e.charCodeAt(0)===c&&(e=e.substring(1));var t=e.length-1;return e.charCodeAt(t)===c?e.substring(0,t):e}function f(e){return(e=h(e))===s?[s]:e.split(s)}function g(e,t,o){return o=e[o],t.val===o&&t.type===r||(o===s?t.type>i:t.type!==r&&(o||"").endsWith(t.end))}function m(e,t){for(var o,s,r=0,i=f(e),c=i.length,u=g.bind(g,i);r<t.length;r++)if(((s=(o=t[r]).length)===c||s<c&&o[s-1].type===a||s>c&&o[s-1].type===l)&&n(o,u))return o;return[]}function _(e){if(e===s)return[{old:e,type:r,val:e,end:""}];for(var t,o,n,f,g=h(e),m=-1,_=0,b=g.length,v=[];++m<b;)if((t=g.charCodeAt(m))!==u)if(t!==d){for(_=m;m<b&&g.charCodeAt(m)!==c;)++m;v.push({old:e,type:r,val:g.substring(_,m),end:""}),g=g.substring(m),b-=m,m=_=0}else v.push({old:e,type:a,val:g.substring(m),end:""});else{for(_=m+1,n=i,o=0,f="";m<b&&g.charCodeAt(m)!==c;)(t=g.charCodeAt(m))===p?(o=m,n=l):46===t&&0===f.length&&(f=g.substring(o=m)),m++;v.push({old:e,type:n,val:g.substring(_,o||m),end:f}),g=g.substring(m),b-=m,m=0}return v}function b(e,t){for(var o,n,r=0,i=f(e),a={};r<t.length;r++)o=i[r],n=t[r],o!==s&&void 0!==o&&n.type|2===l&&(a[n.val]=o.replace(n.end,""));return a}}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n=o(265);module.exports=n})();